<!DOCTYPE html>
<html>
<head>
    <title>å‰ç«¯é£é™©è¯„ä¼°æµ‹è¯•</title>
</head>
<body>
    <h2>å‰ç«¯é£é™©è¯„ä¼°é€»è¾‘æµ‹è¯•</h2>
    <div id="results"></div>

    <script>
        // æ¨¡æ‹Ÿå‰ç«¯çš„é£é™©è¯„ä¼°é€»è¾‘
        function generateDialogueStrategy(analysis, user_input) {
            const { sentiment_score, emotion_intensity } = analysis;
            
            let strategy = {
                risk_level: 'minimal'
            };
            
            // æ ¹æ®æƒ…ç»ªå¼ºåº¦å’Œæƒ…æ„Ÿææ€§è°ƒæ•´é£é™©ç­‰çº§ï¼ŒåŒæ—¶è€ƒè™‘å…³é”®è¯åŒ¹é…
            let risk_score = 0
            
            // 1. åŸºäºæƒ…ç»ªå¼ºåº¦å’Œææ€§çš„åŸºç¡€è¯„åˆ†
            if (sentiment_score < -0.6 && emotion_intensity > 0.6) {
                risk_score = 4 // é«˜é£é™©
            } else if (sentiment_score < -0.3 && emotion_intensity > 0.4) {
                risk_score = 3 // ä¸­ç­‰é£é™©
            } else if (sentiment_score > 0.3) {
                risk_score = emotion_intensity > 0.7 ? 2 : 1 // ä½é£é™©æˆ–æä½é£é™©
            } else if (sentiment_score >= -0.3 && sentiment_score <= 0.3) {
                risk_score = 2 // ä½é£é™©
            } else if (sentiment_score < -0.3) {
                risk_score = 2 // è½»å¾®è´Ÿé¢æƒ…ç»ª = ä½é£é™©
            }
            
            // 2. æ£€æŸ¥ç¤¾äº¤å›°éš¾å…³é”®è¯ï¼ˆä¸åç«¯é€»è¾‘ä¿æŒä¸€è‡´ï¼‰
            const socialIssueKeywords = ['è¯´ä¸ä¸Š', 'æ²¡ä»€ä¹ˆè¯', 'èŠä¸æ¥', 'äº¤æµå›°éš¾', 'ç¤¾äº¤å›°éš¾', 'å¾ˆéš¾äº¤æµ']
            const hasSocialIssues = socialIssueKeywords.some(keyword => user_input.includes(keyword))
            
            if (hasSocialIssues) {
                risk_score += 2 // ç¤¾äº¤å›°éš¾å¢åŠ é£é™©
                console.log('ğŸ” æ£€æµ‹åˆ°ç¤¾äº¤å›°éš¾å…³é”®è¯ï¼Œæå‡é£é™©ç­‰çº§')
            }
            
            // 3. æ£€æŸ¥çŸ›ç›¾æƒ…ç»ªï¼ˆç§¯æè¯æ±‡ + ç¤¾äº¤å›°éš¾ï¼‰
            const positiveKeywords = ['å¿«ä¹', 'å¼€å¿ƒ', 'é«˜å…´', 'æ„‰å¿«', 'å¹¸ç¦', 'æ»¡è¶³']
            const hasPositive = positiveKeywords.some(keyword => user_input.includes(keyword))
            
            if (hasPositive && hasSocialIssues) {
                risk_score += 1 // çŸ›ç›¾æƒ…ç»ªæ¨¡å¼
                console.log('ğŸ” æ£€æµ‹åˆ°çŸ›ç›¾æƒ…ç»ªæ¨¡å¼ï¼ˆç§¯æ+ç¤¾äº¤å›°éš¾ï¼‰ï¼Œè¿›ä¸€æ­¥æå‡é£é™©ç­‰çº§')
            }
            
            // 4. ç¡®å®šæœ€ç»ˆé£é™©ç­‰çº§
            if (risk_score >= 5) {
                strategy.risk_level = 'high'
            } else if (risk_score >= 3) {
                strategy.risk_level = 'medium'
            } else if (risk_score >= 2) {
                strategy.risk_level = 'low'
            } else {
                strategy.risk_level = 'minimal'
            }
            
            return { strategy, risk_score, hasSocialIssues, hasPositive };
        }

        // æµ‹è¯•æ¡ˆä¾‹
        const testCases = [
            {
                description: "è¡¨è¾¾ç§¯ææƒ…ç»ª",
                user_input: "æˆ‘å¾ˆå¿«ä¹",
                analysis: { sentiment_score: 0.5, emotion_intensity: 0.8 },
                expected: "low"
            },
            {
                description: "ç¤¾äº¤å›°éš¾",
                user_input: "æ„Ÿè§‰å’Œå¤§å®¶éƒ½è¯´ä¸ä¸Šä»€ä¹ˆè¯",
                analysis: { sentiment_score: -0.2, emotion_intensity: 0.3 },
                expected: "medium"
            },
            {
                description: "çŸ›ç›¾æƒ…ç»ªï¼šå¿«ä¹ä½†å­¤ç‹¬",
                user_input: "æˆ‘å¾ˆå¿«ä¹ï¼Œä½†æ˜¯æ„Ÿè§‰å’Œå¤§å®¶éƒ½è¯´ä¸ä¸Šä»€ä¹ˆè¯",
                analysis: { sentiment_score: 0.2, emotion_intensity: 0.5 },
                expected: "high"
            }
        ];

        let results = '<h3>æµ‹è¯•ç»“æœï¼š</h3>';
        
        testCases.forEach((testCase, index) => {
            const result = generateDialogueStrategy(testCase.analysis, testCase.user_input);
            const passed = result.strategy.risk_level === testCase.expected;
            
            results += `
                <div style="margin: 10px 0; padding: 10px; border: 1px solid ${passed ? 'green' : 'red'};">
                    <h4>æµ‹è¯• ${index + 1}: ${testCase.description}</h4>
                    <p><strong>è¾“å…¥:</strong> "${testCase.user_input}"</p>
                    <p><strong>é¢„æœŸé£é™©:</strong> ${testCase.expected}</p>
                    <p><strong>å®é™…é£é™©:</strong> ${result.strategy.risk_level}</p>
                    <p><strong>é£é™©åˆ†æ•°:</strong> ${result.risk_score}</p>
                    <p><strong>ç¤¾äº¤å›°éš¾:</strong> ${result.hasSocialIssues}</p>
                    <p><strong>ç§¯ææƒ…ç»ª:</strong> ${result.hasPositive}</p>
                    <p><strong>ç»“æœ:</strong> <span style="color: ${passed ? 'green' : 'red'};">${passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</span></p>
                </div>
            `;
        });

        document.getElementById('results').innerHTML = results;
    </script>
</body>
</html>
