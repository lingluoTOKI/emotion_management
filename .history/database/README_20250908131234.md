# 情绪管理系统数据库部署指南

## 概述

本目录包含了情绪管理系统的数据库部署脚本和配置文件，支持自动检测本地MySQL环境并适配部署。

## 文件说明

### 部署脚本
- `quick_deploy.bat` - **推荐使用**：快速部署脚本，自动检测环境并完成部署
- `deploy_database.bat` - 完整部署脚本，提供详细的错误处理和配置选项
- `detect_mysql_env.py` - MySQL环境检测脚本，自动识别MySQL安装和配置
- `generate_config.py` - 配置文件生成脚本，根据检测结果生成配置文件

### 数据库脚本
- `init.sql` - 数据库结构初始化脚本
- `init_db.py` - Python数据库初始化脚本，包含示例数据
- `create_mysql_user.sql` - MySQL用户创建脚本

### 配置文件
- `config.env.template` - 配置文件模板
- `mysql_config.json` - MySQL环境检测结果（自动生成）
- `config.env` - 生成的配置文件（自动生成）

## 快速开始

### 方法1：使用快速部署脚本（推荐）

1. 确保MySQL已安装并启动
2. 双击运行 `quick_deploy.bat`
3. 脚本会自动：
   - 检测MySQL环境
   - 生成配置文件
   - 创建数据库和用户
   - 初始化表结构
   - 插入示例数据

### 方法2：使用完整部署脚本

1. 运行 `deploy_database.bat`
2. 按照提示操作

### 方法3：手动部署

1. 运行环境检测：
   ```bash
   python detect_mysql_env.py
   ```

2. 生成配置文件：
   ```bash
   python generate_config.py
   ```

3. 创建数据库用户：
   ```bash
   mysql -u root -p < create_mysql_user.sql
   ```

4. 初始化数据库结构：
   ```bash
   mysql -u emotion_user -pemotion123 emotion_management < init.sql
   ```

5. 插入示例数据：
   ```bash
   python init_db.py
   ```

## 环境要求

### 必需软件
- MySQL 5.7+ 或 MySQL 8.0+
- Python 3.8+
- MySQL客户端工具

### 可选软件
- Python虚拟环境（推荐）

## 配置说明

### 默认配置
- 数据库名：`emotion_management`
- 数据库用户：`emotion_user`
- 数据库密码：`emotion123`
- 主机：`localhost`
- 端口：`3306`

### 自定义配置
1. 运行 `detect_mysql_env.py` 检测环境
2. 编辑生成的 `mysql_config.json` 文件
3. 运行 `generate_config.py` 重新生成配置

## 测试账号

部署完成后，系统会创建以下测试账号：

| 角色 | 用户名 | 密码 | 说明 |
|------|--------|------|------|
| 管理员 | admin | 123456 | 系统管理员 |
| 咨询师 | counselor1 | 123456 | 认知行为疗法专家 |
| 咨询师 | counselor2 | 123456 | 人本主义疗法专家 |
| 咨询师 | counselor3 | 123456 | 精神分析专家 |
| 学生 | student1 | 123456 | 计算机专业学生 |
| 学生 | student2 | 123456 | 心理学专业学生 |
| 学生 | student3 | 123456 | 工商管理专业学生 |
| 学生 | student4 | 123456 | 临床医学专业学生 |

## 故障排除

### 常见问题

1. **MySQL连接失败**
   - 检查MySQL服务是否启动
   - 确认root密码是否正确
   - 检查端口3306是否被占用

2. **权限不足**
   - 确保root用户有创建数据库和用户的权限
   - 检查防火墙设置

3. **Python依赖缺失**
   - 安装项目依赖：`pip install -r requirements.txt`
   - 使用虚拟环境：`python -m venv venv`

4. **字符集问题**
   - 确保MySQL使用utf8mb4字符集
   - 检查数据库排序规则

### 手动解决步骤

1. **重置数据库**：
   ```sql
   DROP DATABASE IF EXISTS emotion_management;
   DROP USER IF EXISTS 'emotion_user'@'localhost';
   ```

2. **重新创建**：
   ```bash
   mysql -u root -p < create_mysql_user.sql
   mysql -u emotion_user -pemotion123 emotion_management < init.sql
   python init_db.py
   ```

## 生产环境部署

### 安全配置
1. 修改默认密码
2. 设置强密码策略
3. 配置SSL连接
4. 限制数据库访问权限

### 性能优化
1. 调整MySQL配置参数
2. 创建适当的索引
3. 配置连接池
4. 设置定期备份

## 支持

如果遇到问题，请：
1. 查看错误日志
2. 检查MySQL错误日志
3. 确认环境配置
4. 联系技术支持

## 更新日志

- v1.0.0 - 初始版本，支持自动环境检测和部署
- 支持MySQL 5.7+ 和 8.0+
- 自动配置文件生成
- 智能错误处理和故障排除